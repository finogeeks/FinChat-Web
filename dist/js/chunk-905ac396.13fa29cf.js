(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-905ac396"],{"05ee":function(t,e,i){"use strict";var o=i("f09b"),n=i.n(o);n.a},1216:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARgAAAEYBAMAAAB1oPS/AAAAMFBMVEXY2Nj////6+vr09PTv7+/b29vl5eXy8vL8/Pzo6Oji4uL29vbf39/d3d3s7Ozq6uoYF1TfAAADhklEQVR42u3ay+sNYRgH8K/LuP8c3+N+zSiSFVlQLJzcLTRkI5eQhCS/KAurIzbIraQot7Jg5X7ZsbBRymWDhSgLCwuystMRDuaMGYd53ie+n7/gbeZ5n3nmeR6IiIiIiIiIiIiIiIiIiIiIiIiIeNDv1K6J3H1z4XkE1/Ghzi+unUFYyy+zqboIIa2u8wc3EM6yOn8yAaH0iJkyE2FEU9jCOwRxjq0MTBBAha0dQAA1tjbsDMz1ZJYhMNfJTGtgrDuzjYCxI8w27A5M9eOvjIeppfyVoTDVyV86DEN9+Gt7Yagr6ec9HWEOyywcM8dkmOnNPKNgpivpJ2jOMlcCKzWS9JJp6sx1CUb6MN9gGOnPb8JXWH2ZbxCMdGG+Kow8YgEwspYF3IGN9/wmfFVeI/1kvUKHeQcbnSzgJTLZH2YWWvunn4yrmHF1m155yjOFMvBD2LjLfMNgZAnzjYSRrp7qme6eKr0ezDcARiKSfv5vp/hJM8BaPzcb6OXnMhW5TqNhJmKebbBT8/JlanjqJ2SACumoKx17yTINZ7000Roqjt4SMMXRVAVLPZQPX0Wxl/BteMwsw2GuI/bzYIAVbG0fAog62crIhwihdz27+2DvCdMmIZR1/NkhhHOUPzqYIKCT/N7tBEG9aKab6luEFq2/xYb98xJ4sPLihov3ICL/hOends64Mu4nV6ct3JLAWLR1OrNUF96BpWeXmRJqMfgk8+x5CBsdC5hv4BpYiGosompxmugNixloEMbr+JmLjv0yZrEvzvvF/MLBnHIjU4I1jSr8PddRohp/T7XE3NedKeHanq/4u6oJStKbKcZbael+q4sLlW7jBZz8d2Mm+5XTI0wJNuCO6qSb99STmez3ye8yJVwl0cks9lO5fmzXLDS4CJlStnGXsF1jkGKwQ2m3AHuZbTsDAD7it4QIrrB9Y9Fk8JU0XozoxVxmo7lmYeWhwHpP+rnbNf4BwE2a+fvL7XUWYDTPjViE0W5wB//ELMDL1+CvH6YP/8S2f/gwPfgnJusw/+FhXAVwB4uwasHGLMCqIn/FfGb1zFK2bwQAeIngWWiy2hs37In0idmeYWVMwSr19s4yF2Xo3U4dPPIYyhEdj/l7qgsTlCa6MPsWi9q/40SCkq26v+n06znzd26f2tq0nTvmLP64+YGPrScRERERERERERERERERERERERH533wC+A/UTiY/H6UAAAAASUVORK5CYII="},"18cf":function(t,e,i){t.exports=i.p+"img/ic_mute.cece407d.svg"},e6a8:function(t,e,i){t.exports=i.p+"img/ic_arrow.8d9b7694.svg"},f09b:function(t,e,i){},f432:function(t,e,i){t.exports=i.p+"img/room_set_channel.c52913ef.svg"},ffaf:function(t,e,i){"use strict";i.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[t.showRoomList?o("div",{staticClass:"room-list",style:{height:t.windowHeight+"px",width:t.roomListWidth+"px"}},[o("div",{staticClass:"user-container"},[o("div",{staticClass:"my-avatar"},[o("img",{attrs:{src:t.getMmberAvatar(t.myinfo),alt:""},on:{error:function(e){return t.imgOnError(t.myinfo)}}})]),o("div",{staticClass:"my-name"},[t._v("\n              "+t._s(t.myinfo&&t.myinfo.displayName)+"\n              "),o("img",{staticClass:"option-icon",class:{rotate180:t.showOperateBtn},attrs:{src:i("e6a8"),alt:""},on:{click:function(e){t.showOperateBtn=!t.showOperateBtn}}}),o("div",{staticClass:"logout-btn",class:{active:t.showOperateBtn},on:{click:function(e){t.showQuitModal=!0,t.showOperateBtn=!1}}},[t._v("\n              退出登录\n              ")])]),t.showOperateBtn?o("div",{staticClass:"logout-btn-coverlayer",on:{click:function(e){t.showOperateBtn=!1}}}):t._e()]),o("div",{ref:"roomListContainer",staticClass:"room-list-container",class:{"has-dispatch-room":t.isConsultMode},style:{"overflow-y":t.roomListDraging?"hidden":"auto"}},t._l(t.roomList,(function(e,n){return o("div",{key:n,staticClass:"room-container",class:{active:e.roomId===t.viewingRoomId,"is-top":e.isTop,"room-list-draging":t.roomListDraging},on:{click:function(i){return t.enterRoom(e)}}},[o("div",{staticClass:"avatar-container"},[e&&(e.avatar||e.isDirect)?o("div",[o("img",{staticClass:"room-avatar",attrs:{src:e&&e.imgerror?t.DEFAULT_AVATAR:t.getRoomAvatar(e),alt:""},on:{error:function(i){return t.imgOnError(e)}}})]):o("div",{staticClass:"member-avatar-container"},t._l(e.members&&e.members.slice(0,4),(function(e,i){return o("img",{key:i,staticClass:"member-avatar",attrs:{src:e&&e.imgerror?t.DEFAULT_AVATAR:t.getMmberAvatar(e),alt:""},on:{error:function(i){return t.imgOnError(e)}}})})),0),e.isChannel?o("div",{staticClass:"avatar-wear"},[o("img",{attrs:{src:i("f432"),alt:""}})]):t._e()]),o("div",{staticClass:"room-overview"},[o("div",{staticClass:"room-name"},[o("span",{staticStyle:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},style:{"max-width":t.roomListWidth-171+"px"}},[t._v(t._s(e.name))]),e.isSecret?o("div",{staticClass:"room-tag"},[t._v("保密")]):e.isChannel&&e.isPrivateChannel?o("div",{staticClass:"room-tag"},[t._v("私密")]):t._e(),o("span",{staticStyle:{float:"right","font-size":"12px",color:"#999999","flex-grow":"1","text-align":"right"}},[t._v(t._s(t.getLastMsgTime(e.lastMessage&&e.lastMessage.eventTime)))])]),e.roomEditingMsg&&"<br>"!==e.roomEditingMsg&&e.roomId!==t.viewingRoom.roomId?o("div",{staticClass:"room-lastmessage"},[o("span",{staticClass:"m-alert"},[t._v("[草稿]")]),t._v("\n                    "+t._s(t.computeRoomEditingMsg(e.roomEditingMsg))+"\n                ")]):o("div",{staticClass:"room-lastmessage"},[t.showAlertMsg(e)?o("span",{staticClass:"m-alert"},[t._v("[有人@我]")]):t._e(),t._v("\n                    "+t._s(t.getLastMsg(e.lastMessage,e))+"\n                ")])]),o("div",{staticClass:"room-tip"},[e.isMute?o("div",{staticStyle:{display:"flex","align-items":"center"}},[o("img",{attrs:{src:i("18cf"),alt:""}})]):t._e(),e.isMute&&e.unread?o("div",{staticClass:"mute-unread"}):t._e(),!e.isMute&&e.unread?o("div",{staticClass:"unread"},[t._v("\n                  "+t._s(e.unread)+"\n                ")]):t._e()])])})),0)]):t._e(),o("Modal",{staticClass:"quit-confirm-modal",attrs:{width:"360",closable:!1,"mask-closable":!1},model:{value:t.showQuitModal,callback:function(e){t.showQuitModal=e},expression:"showQuitModal"}},[o("p",[o("Icon",{staticStyle:{color:"#ff9900","font-size":"20px","vertical-align":"middle","margin-right":"4px"},attrs:{type:"ios-information-circle"}}),o("span",{staticClass:"quit-text"},[t._v("确定退出登录吗？")])],1),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("Button",{on:{click:t.cancleQuit}},[t._v("取消")]),o("Button",{attrs:{type:"primary"},on:{click:t.confirmQuit}},[t._v("确定")])],1)])],1)},n=[],r=(i("1c01"),i("58b2"),i("8e6e"),i("456d"),i("7514"),i("0cd8"),i("bd86")),a=(i("96cf"),i("3b8d")),s=(i("d25f"),i("ac6a"),i("f3e2"),i("4917"),i("a481"),i("2f62")),c=i("7823"),l=i("a9e1");i("fcf0");function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,o)}return i}function m(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(i,!0).forEach((function(e){Object(r["a"])(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}window.matrix;var g={components:{},props:["viewingRoomId","isConsultMode"],data:function(){return{DEFAULT_AVATAR:i("1216"),showOperateBtn:!1,showQuitModal:!1,drafts:[],confirmFile:{},uploadQueue:[],showGotoBottomBtn:!1,faviconSwitch:null,oriScrollTop:null}},mounted:function(){this.hasUnread&&this.switchFavicon()},methods:{computeRoomEditingMsg:function(t){var e=t.replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<br>/g,"\n").replace(/&nbsp;/g," "),i=e.match(/<img class="emojione" .+?>/g);i&&i.length&&i.forEach((function(t){var i=t.match(/alt="(.+?)"/);e=e.replace(t,i[1])}));var o=[],n=[],r=/<label data-user-id="(.+?)" .+?>(.+?)<\/label>/g.exec(e);while(r)o.push(r[1]),e=e.replace(r[0],r[2]),n.push({start:r.index,end:r.index+r[2].length,type:"@",val:r[1]}),r=/<label data-user-id="(.+?)" .+?>(.+?)<\/label>/g.exec(e);return e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">"),e},switchFavicon:function(){var t=this;clearInterval(this.faviconSwitch),this.faviconSwitch=null;var e=!1;this.faviconSwitch=setInterval((function(){t.changeImgAndTitle(e),e=!e}),1e3)},stopSwitchFavicon:function(){clearInterval(this.faviconSwitch),this.faviconSwitch=null,this.changeImgAndTitle(!0)},changeImgAndTitle:function(t){var e=this,i=document.getElementsByTagName("head")[0],o=Array.prototype.filter.call(i.childNodes,(function(t){return"icon"===t.rel}));o.forEach((function(e){e.href=t?"./old_favicon.png":"./new_favicon.png"}));var n=document.getElementsByTagName("title");Array.prototype.filter.call(n,(function(i){i.innerHTML=t?c["h"]:"".concat(c["h"],"(").concat(e.hasUnread,")")}))},enterRoom:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$emit("enterRoom",e);case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getRoomAvatar:function(t){if(window.matrix&&window.matrix.user)return t.avatar?window.matrix.user.mxcTransfer(t.avatar||""):this.DEFAULT_AVATAR},getMmberAvatar:function(t){if(window.matrix&&window.matrix.user)return t?t&&t.avatarUrl?window.matrix.user.mxcTransfer(t.avatarUrl||""):this.DEFAULT_AVATAR:""},imgOnError:function(t){t.imgerror=!0,this.$forceUpdate()},getLastMsgTime:function(t){var e=new Date(+t),i=new Date;return t?e.getFullYear()===i.getFullYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()?"".concat(e.getHours()>12?"下午":"上午").concat(e.getHours()>12?e.getHours()-12:e.getHours(),":").concat(e.getMinutes()>9?"":0).concat(e.getMinutes()):"".concat(e.getMonth()+1,"/").concat(e.getDate()):""},getLastMsg:function(t,e){return t?t.senderId===this.myinfo.userId||"notice"===t.msgType||e.isDirect?t.msgBody:"".concat(t.sender,":").concat(t.msgBody):""},cancleQuit:function(){this.showQuitModal=!1,this.showOperateBtn=!1},confirmQuit:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].logout();case 2:indexedDB.deleteDatabase("matrix-js-sdk:default"),window.localStorage.removeItem(c["b"]),this.stopSwitchFavicon(),window.matrix.stop(),window.matrix=null,this.$router.push("/login");case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showAlertMsg:function(t){return t.totlaunread>0&&t.highlightunread>0}},computed:m({},Object(s["b"])(["showRoomList","windowHeight","windowWidth","userList","myinfo","hasOldTimelineTable","roomListWidth","roomListDraging"]),{roomList:function(){console.log("VUEX STORE: roomList");var t=this.$store.state.roomList.filter((function(t){return!t.isDelete}));console.log(t);var e=this.$refs.roomListContainer;if(this.roomListDraging){var i=e.scrollTop,o=Math.floor(i/60),n=Math.floor(this.windowHeight/60)+1+o;return this.oriScrollTop=i,this.$nextTick((function(){e&&(e.scrollTop=i%60)})),t.slice(o,n)}return t},hasUnread:function(){return this.roomList.reduce((function(t,e){return t+(e.isMute?0:e.unread)}),0)},viewingRoom:function(){var t=this;return this.roomList.find((function(e){return e.roomId===t.viewingRoomId}))||{}}}),watch:{roomListDraging:function(t){var e=this,i=this.$refs.roomListContainer;t||this.$nextTick((function(){i&&null!==e.oriScrollTop&&(i.scrollTop=e.oriScrollTop)}))},hasUnread:function(t){t?this.switchFavicon():this.stopSwitchFavicon()}}},d=g,h=(i("05ee"),i("2877")),f=Object(h["a"])(d,o,n,!1,null,null,null);e["default"]=f.exports}}]);