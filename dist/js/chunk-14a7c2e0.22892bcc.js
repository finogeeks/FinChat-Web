(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-14a7c2e0"],{"05ee":function(t,e,o){"use strict";var i=o("f09b"),n=o.n(i);n.a},"18cf":function(t,e,o){t.exports=o.p+"img/ic_mute.cece407d.svg"},"341f":function(t,e,o){"use strict";var i=o("66f9"),n=o.n(i);n.a},"66f9":function(t,e,o){},a5c8:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"chat"},[o("div",{staticClass:"chat-container"},[o("room-list",{attrs:{viewingRoomId:t.viewingRoomId,isConsultMode:!0},on:{enterRoom:t.enterRoom}}),o("viewing-room",{ref:"viewingRoom",attrs:{viewingRoomId:t.viewingRoomId,isConsultMode:!0},on:{quitRoom:function(e){t.viewingRoomId=null}}})],1)])},n=[],r=(o("1c01"),o("58b2"),o("8e6e"),o("f3e2"),o("d25f"),o("ac6a"),o("456d"),o("bd86")),a=(o("96cf"),o("3b8d")),s=o("e047"),c=o("2f62"),l=o("ffaf"),u=o("f76d");function m(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}function f(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?m(o,!0).forEach((function(e){Object(r["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):m(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var d={beforeRouteEnter:function(t,e,o){o()},components:{"room-list":l["default"],"viewing-room":u["default"]},created:function(){},data:function(){return{viewingRoomId:""}},mounted:function(){s["a"].addListener("ROOMS_INIT",(function(t){setTimeout((function(){}),0)}))},methods:{afterEnterRoom:function(){var t=this;setTimeout((function(){t.$refs.viewingRoom.scrollToBottom()}),500)},enterRoom:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){var o,i=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=this.viewingRoomId===e.roomId,!o){t.next=3;break}return t.abrupt("return");case 3:return this.$refs.viewingRoom.saveOldEditMsg(),this.$refs.viewingRoom.saveEditingMsg(),t.next=7,window.matrix.viewingRoom.addViewingRoom(e.roomId);case 7:this.viewingRoomId=e.roomId,this.hasOldTimelineTable[this.viewingRoomId]=null,this.afterEnterRoom(),this.$nextTick((function(){i.$refs.viewingRoom.clearEditingMsg()}));case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},computed:f({},Object(c["b"])(["showRoomList","windowHeight","windowWidth","userList","myinfo","hasOldTimelineTable","globalDispatchData"])),watch:{globalDispatchData:function(t){}}},g=d,h=(o("341f"),o("2877")),v=Object(h["a"])(g,i,n,!1,null,null,null);e["default"]=v.exports},e6a8:function(t,e,o){t.exports=o.p+"img/ic_arrow.8d9b7694.svg"},f09b:function(t,e,o){},f432:function(t,e,o){t.exports=o.p+"img/room_set_channel.c52913ef.svg"},ffaf:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.showRoomList?i("div",{staticClass:"room-list",style:{height:t.windowHeight+"px",width:t.roomListWidth+"px"}},[i("div",{staticClass:"user-container"},[i("div",{staticClass:"my-avatar"},[i("img",{attrs:{src:t.getMmberAvatar(t.myinfo),alt:""},on:{error:function(e){return t.imgOnError(t.myinfo)}}})]),i("div",{staticClass:"my-name"},[t._v("\n              "+t._s(t.myinfo&&t.myinfo.displayName)+"\n              "),i("img",{staticClass:"option-icon",class:{rotate180:t.showOperateBtn},attrs:{src:o("e6a8"),alt:""},on:{click:function(e){t.showOperateBtn=!t.showOperateBtn}}}),i("div",{staticClass:"logout-btn",class:{active:t.showOperateBtn},on:{click:function(e){t.showQuitModal=!0,t.showOperateBtn=!1}}},[t._v("\n              退出登录\n              ")])]),t.showOperateBtn?i("div",{staticClass:"logout-btn-coverlayer",on:{click:function(e){t.showOperateBtn=!1}}}):t._e()]),i("div",{ref:"roomListContainer",staticClass:"room-list-container",class:{"has-dispatch-room":t.isConsultMode},style:{"overflow-y":t.roomListDraging?"hidden":"auto"}},t._l(t.roomList,(function(e,n){return i("div",{key:n,staticClass:"room-container",class:{active:e.roomId===t.viewingRoomId,"is-top":e.isTop,"room-list-draging":t.roomListDraging},on:{click:function(o){return t.enterRoom(e)}}},[i("div",{staticClass:"avatar-container"},[e&&(e.avatar||e.isDirect)?i("div",[i("img",{staticClass:"room-avatar",attrs:{src:e&&e.imgerror?t.DEFAULT_AVATAR:t.getRoomAvatar(e),alt:""},on:{error:function(o){return t.imgOnError(e)}}})]):i("div",{staticClass:"member-avatar-container"},t._l(e.members&&e.members.slice(0,4),(function(e,o){return i("img",{key:o,staticClass:"member-avatar",attrs:{src:e&&e.imgerror?t.DEFAULT_AVATAR:t.getMmberAvatar(e),alt:""},on:{error:function(o){return t.imgOnError(e)}}})})),0),e.isChannel?i("div",{staticClass:"avatar-wear"},[i("img",{attrs:{src:o("f432"),alt:""}})]):t._e()]),i("div",{staticClass:"room-overview"},[i("div",{staticClass:"room-name"},[i("span",{staticStyle:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},style:{"max-width":t.roomListWidth-171+"px"}},[t._v(t._s(e.name))]),e.isSecret?i("div",{staticClass:"room-tag"},[t._v("保密")]):e.isChannel&&e.isPrivateChannel?i("div",{staticClass:"room-tag"},[t._v("私密")]):t._e(),i("span",{staticStyle:{float:"right","font-size":"12px",color:"#999999","flex-grow":"1","text-align":"right"}},[t._v(t._s(t.getLastMsgTime(e.lastMessage&&e.lastMessage.eventTime)))])]),e.roomEditingMsg&&"<br>"!==e.roomEditingMsg&&e.roomId!==t.viewingRoom.roomId?i("div",{staticClass:"room-lastmessage"},[i("span",{staticClass:"m-alert"},[t._v("[草稿]")]),t._v("\n                    "+t._s(t.computeRoomEditingMsg(e.roomEditingMsg))+"\n                ")]):i("div",{staticClass:"room-lastmessage"},[t.showAlertMsg(e)?i("span",{staticClass:"m-alert"},[t._v("[有人@我]")]):t._e(),t._v("\n                    "+t._s(t.getLastMsg(e.lastMessage,e))+"\n                ")])]),i("div",{staticClass:"room-tip"},[e.isMute?i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("img",{attrs:{src:o("18cf"),alt:""}})]):t._e(),e.isMute&&e.unread?i("div",{staticClass:"mute-unread"}):t._e(),!e.isMute&&e.unread?i("div",{staticClass:"unread"},[t._v("\n                  "+t._s(e.unread)+"\n                ")]):t._e()])])})),0)]):t._e(),i("Modal",{staticClass:"quit-confirm-modal",attrs:{width:"360",closable:!1,"mask-closable":!1},model:{value:t.showQuitModal,callback:function(e){t.showQuitModal=e},expression:"showQuitModal"}},[i("p",[i("Icon",{staticStyle:{color:"#ff9900","font-size":"20px","vertical-align":"middle","margin-right":"4px"},attrs:{type:"ios-information-circle"}}),i("span",{staticClass:"quit-text"},[t._v("确定退出登录吗？")])],1),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:t.cancleQuit}},[t._v("取消")]),i("Button",{attrs:{type:"primary"},on:{click:t.confirmQuit}},[t._v("确定")])],1)])],1)},n=[],r=(o("1c01"),o("58b2"),o("8e6e"),o("456d"),o("7514"),o("0cd8"),o("bd86")),a=(o("96cf"),o("3b8d")),s=(o("d25f"),o("ac6a"),o("f3e2"),o("4917"),o("a481"),o("2f62")),c=o("7823"),l=o("a9e1");o("fcf0");function u(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}function m(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?u(o,!0).forEach((function(e){Object(r["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):u(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}window.matrix;var f={components:{},props:["viewingRoomId","isConsultMode"],data:function(){return{DEFAULT_AVATAR:o("1216"),showOperateBtn:!1,showQuitModal:!1,drafts:[],confirmFile:{},uploadQueue:[],showGotoBottomBtn:!1,faviconSwitch:null,oriScrollTop:null}},mounted:function(){this.hasUnread&&this.switchFavicon()},methods:{computeRoomEditingMsg:function(t){var e=t.replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<br>/g,"\n").replace(/&nbsp;/g," "),o=e.match(/<img class="emojione" .+?>/g);o&&o.length&&o.forEach((function(t){var o=t.match(/alt="(.+?)"/);e=e.replace(t,o[1])}));var i=[],n=[],r=/<label data-user-id="(.+?)" .+?>(.+?)<\/label>/g.exec(e);while(r)i.push(r[1]),e=e.replace(r[0],r[2]),n.push({start:r.index,end:r.index+r[2].length,type:"@",val:r[1]}),r=/<label data-user-id="(.+?)" .+?>(.+?)<\/label>/g.exec(e);return e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">"),e},switchFavicon:function(){var t=this;clearInterval(this.faviconSwitch),this.faviconSwitch=null;var e=!1;this.faviconSwitch=setInterval((function(){t.changeImgAndTitle(e),e=!e}),1e3)},stopSwitchFavicon:function(){clearInterval(this.faviconSwitch),this.faviconSwitch=null,this.changeImgAndTitle(!0)},changeImgAndTitle:function(t){var e=this,o=document.getElementsByTagName("head")[0],i=Array.prototype.filter.call(o.childNodes,(function(t){return"icon"===t.rel}));i.forEach((function(e){e.href=t?"./old_favicon.png":"./new_favicon.png"}));var n=document.getElementsByTagName("title");Array.prototype.filter.call(n,(function(o){o.innerHTML=t?c["h"]:"".concat(c["h"],"(").concat(e.hasUnread,")")}))},enterRoom:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.$emit("enterRoom",e);case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}(),getRoomAvatar:function(t){if(window.matrix&&window.matrix.user)return t.avatar?window.matrix.user.mxcTransfer(t.avatar||""):this.DEFAULT_AVATAR},getMmberAvatar:function(t){if(window.matrix&&window.matrix.user)return t?t&&t.avatarUrl?window.matrix.user.mxcTransfer(t.avatarUrl||""):this.DEFAULT_AVATAR:""},imgOnError:function(t){t.imgerror=!0,this.$forceUpdate()},getLastMsgTime:function(t){var e=new Date(+t),o=new Date;return t?e.getFullYear()===o.getFullYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?"".concat(e.getHours()>12?"下午":"上午").concat(e.getHours()>12?e.getHours()-12:e.getHours(),":").concat(e.getMinutes()>9?"":0).concat(e.getMinutes()):"".concat(e.getMonth()+1,"/").concat(e.getDate()):""},getLastMsg:function(t,e){return t?t.senderId===this.myinfo.userId||"notice"===t.msgType||e.isDirect?t.msgBody:"".concat(t.sender,":").concat(t.msgBody):""},cancleQuit:function(){this.showQuitModal=!1,this.showOperateBtn=!1},confirmQuit:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l["a"].logout();case 2:indexedDB.deleteDatabase("matrix-js-sdk:default"),window.localStorage.removeItem(c["b"]),this.stopSwitchFavicon(),window.matrix.stop(),window.matrix=null,this.$router.push("/login");case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),showAlertMsg:function(t){return t.totlaunread>0&&t.highlightunread>0}},computed:m({},Object(s["b"])(["showRoomList","windowHeight","windowWidth","userList","myinfo","hasOldTimelineTable","roomListWidth","roomListDraging"]),{roomList:function(){console.log("VUEX STORE: roomList");var t=this.$store.state.roomList.filter((function(t){return!t.isDelete}));console.log(t);var e=this.$refs.roomListContainer;if(this.roomListDraging){var o=e.scrollTop,i=Math.floor(o/60),n=Math.floor(this.windowHeight/60)+1+i;return this.oriScrollTop=o,this.$nextTick((function(){e&&(e.scrollTop=o%60)})),t.slice(i,n)}return t},hasUnread:function(){return this.roomList.reduce((function(t,e){return t+(e.isMute?0:e.unread)}),0)},viewingRoom:function(){var t=this;return this.roomList.find((function(e){return e.roomId===t.viewingRoomId}))||{}}}),watch:{roomListDraging:function(t){var e=this,o=this.$refs.roomListContainer;t||this.$nextTick((function(){o&&null!==e.oriScrollTop&&(o.scrollTop=e.oriScrollTop)}))},hasUnread:function(t){t?this.switchFavicon():this.stopSwitchFavicon()}}},d=f,g=(o("05ee"),o("2877")),h=Object(g["a"])(d,i,n,!1,null,null,null);e["default"]=h.exports}}]);